action = <%= @action%> <br>

<% if false%>
project = 
	<%= @project%> <br><br>

tasks = <%= @tasks%>
<% end %>

<p>
	<%= link_to 'Back to Project', {controller: 'project', action: 'show', id: @project['_id'].to_s }%>

 



<%#= form_tag(controller: "tasklist_generator", action: "update", method: "patch") do %>
<%= form_tag({controller: "tasklist_generator", action: "update", id: @project['_id'].to_s },  {multipart: true, method: :patch})  do %>

	Choose Action:<br>
	<%= select_tag("actionSelect", options_for_select([['Set Start Date', 'set start date'], ['Set Due Date', 'set due date'], ['Mark Done', 'mark done']]), {include_blank: 'none'} ) %>
	<br><br>


	<div id="startDateSelector" style="display:none;" class="action">
		<p>
			Start Date:
			<%= date_select 'start date', 'date',selected: Date.today ,class: "required textField" %>
			<%#= text_field_tag 'dueDate'%>
			<%#= date_select 'dueDate', 'date' %>
		</p>
	</div>


	<div id="dueDateSelector" style="display:none;" class="action">
		<p>
			Due Date:
			<%= date_select 'due date', 'date' , selected: Date.today ,class: "required textField" %>
			<%#= text_field_tag 'dueDate'%>
			<%#= date_select 'dueDate', 'date' %>
		</p>
	</div>
	
	<div style="float:left; width:2000px; height_:100px;">
		<div style="float:left; width:400px;">
			Task
		</div>
		
		<div style="float:left; width:140px;">
			<% #Start Date %>
			<%= link_to 'Start Date', {action: 'sortByTime',  projectId: @project['_id'], 'sort by start time' => true} %>
		</div>

		<div style="float:left; width:400px;">
			<%#Due Date %>
			<%= link_to 'Due Date', {action: 'sortByTime',  projectId: @project['_id'], 'sort by due date' => true} %>
		</div>
		
		<div style="float:left; width:200px;">
			Value Estimate
		</div>

	</div>
	<hr>
	
	<% i = 0 %> 
	<% for task in @tasks %>
		<% if task.has_key? 'isDone' and task['isDone'] == true %>
			<% if task.has_key? 'dueDate' and task['dueDate'] < task['marked done at'] #if task was marked done after its due date%>
				<div style="float:left; width:2000px; height_:100px; background-color:orange;">	
			<% else %>
				<div style="float:left; width:2000px; height_:100px; background-color:green;">
			<% end %>
		<% else %>
			<% if task.has_key? 'dueDate' and task['dueDate'] < Time.now %>
				<div style="float:left; width:2000px; height_:100px; background-color:red;">
			<% elsif task.has_key? 'start date' and task['start date'] < Time.now %>
				<div style="float:left; width:2000px; height_:100px; background-color:yellow;">
			<% else %>
				<div style="float:left; width:2000px; height_:100px;">
			<% end %>
		<% end %>
			<%#= task%>
			<div style="float:left; width:400px;">
				<%= check_box_tag "[tasks][#{i}]" %>
				<%= task['task'] %> 
				<%#= task[(i+1).to_s] %> 
			</div>
			
			<div style="float:left; width:140px;">
				<% if task.has_key? 'start date'%>
					<%= task['start date'].to_s.split()[0]%>
				<% else %>
					<%= " _ "%>
				<% end %>
			</div>
		
			<div style="float:left; width:200px;">
				<% if task.has_key? 'dueDate'%>
					<%= task['dueDate'].to_s.split()[0]%>
				<% else %>
					<%= " _ "%>
				<% end %>
			</div>
			
			<div style="float:left; width:200px;">
				<%= file_field_tag "[taskFiles][#{i}]" %>
				<% if task.has_key? 'files'%>
					<%= link_to 'Show Task Files', {action: 'showTaskFiles', taskNum: i, projectId: @project['_id']} %>
				<% end %>
			</div>
			
			<div style="float:left; width:200px;">
				<%= ((task['value estimate'].to_f * 1000).to_i.to_f / 10.0)  %>%
			</div>
		</div>
		
		<%= text_field_tag "[taskComments][#{i}]", task['comment'], style:"width:300px;" %>

		<hr>
		<% i = i+1%>
	<% end %>
	
	
	
	<%= submit_tag "submit"%>

<% end %>
<br>



<% if false%>
	---------
	<%for r in @s.first_row.to_i .. @s.last_row.to_i %>
		<%#= @s.row(r)%>
		<% if @s.row(r)[0].downcase.include? 'antenna install'%>
			<% #TBD (Antenna Install) <br> TODO put antenna JCR form as an html form maybe %>
			<%= @s.row(r) %> <br>
		<% else %>
			<%= @s.row(r) %> <br>
		<% end %>
	<% end %>
<% end %>
